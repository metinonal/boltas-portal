<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8">
    <title>Ana Sayfa | Boltas Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
    <meta content="Coderthemes" name="author">

    <%- include("partials/css") %>

        <style>
            .clickable {
                cursor: pointer;
                user-select: none;
                color: #ff6600;
                /* Bootstrap'in mavi tonuna uygun */
            }

            .clickable:hover {
                color: #0056b3;
                /* Daha koyu bir mavi tonu */
                text-decoration: none;
                /* Hover sırasında altı çizgi kalkar */
            }

            /* Ayarlara göre gizleme */
            .birthday-section {
                display: <%= (settings && settings.show_birthdays === false) ? 'none' : 'block' %>;
            }

            .new-hires-section {
                display: <%= (settings && settings.show_new_hires === false) ? 'none' : 'block' %>;
            }

            .leavers-section {
                display: <%= (settings && settings.show_leavers === false) ? 'none' : 'block' %>;
            }
        </style>

</head>

<body class="loading" data-layout-color="light" data-layout="topnav" data-layout-mode="fluid"
    data-rightbar-onstart="true">
    <!-- Begin page -->
    <div class="wrapper">

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="content">
                <!-- Topbar Start -->
                <%- include("partials/topbar") %>
                    <!-- end Topbar -->

                    <%- include("partials/topnav") %>


                        <!-- Start Content-->
                        <div class="container-fluid">

                            <!-- start page title -->
                            <!-- <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <h4 class="page-title">Boltas Portal</h4>
                                </div>
                            </div>
                        </div> -->
                            <!-- end page title -->

                            <div class="row mb-3 mt-3">
                                <div class="col-lg-3 col-md-12 col-sm-12">
                                    <div class="card mb-3">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <span><strong>Günün Yemek Listesi</strong></span>
                                            <a href="/yemek-listesi" class=" text-decoration-none small" target="_blank">
                                                Tümünü Gör
                                            </a>
                                        </div>
                                        <div class="card-body">
                                            <ul class="nav nav-pills bg-nav-pills nav-justified mb-3">
                                                <li class="nav-item">
                                                    <a href="#istanbul" data-bs-toggle="tab" aria-expanded="true" class="nav-link rounded-0 active">
                                                        <span class="d-none d-md-block">İstanbul</span>
                                                        <span class="d-md-none d-block">İstanbul</span>
                                                    </a>
                                                </li>
                                                <li class="nav-item">
                                                    <a href="#dilovasi" data-bs-toggle="tab" aria-expanded="false" class="nav-link rounded-0">
                                                        <span class="d-none d-md-block">Dilovası</span>
                                                        <span class="d-md-none d-block">Dilovası</span>
                                                    </a>
                                                </li>
                                            </ul>

                                            <div class="tab-content">
                                                <!-- İstanbul -->
                                                <div class="tab-pane show active menu" id="istanbul">
                                                    <% if (todayMenuIstanbul) { %>
                                                        <ul class="list-group list-group-flush">
                                                            <% let foundSalad = false; %>
                                                            <% let saladIndex = -1; %>
                                                            <% todayMenuIstanbul.meals.forEach((meal, index) => { %>
                                                                <% if (meal.name === "SALATA VE ZEYTİNYAĞLI BÜFESİ") { %>
                                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                        <span class="clickable" data-bs-toggle="collapse" data-bs-target="#dropdown-istanbul-<%= index %>" aria-expanded="false" aria-controls="dropdown-istanbul-<%= index %>">
                                                                            <%= meal.name %>
                                                                        </span>
                                                                        <% if (meal.calorie) { %>
                                                                            <span class="badge bg-primary text-white"><%= meal.calorie %> kcal</span>
                                                                        <% } %>
                                                                    </li>
                                                                    <% foundSalad = true; saladIndex = index; %>
                                                                    <ul class="list-group list-group-flush collapse" id="dropdown-istanbul-<%= index %>">
                                                                <% } else if (foundSalad) { %>
                                                                    <li class="list-group-item"><span><%= meal.name %></span></li>
                                                                <% } else { %>
                                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                        <span><%= meal.name %></span>
                                                                        <% if (meal.calorie) { %>
                                                                            <span class="badge bg-primary text-white"><%= meal.calorie %> kcal</span>
                                                                        <% } %>
                                                                    </li>
                                                                <% } %>
                                                            <% }) %>
                                                            <% if (foundSalad) { %></ul><% } %>
                                                        </ul>
                                                    <% } else { %>
                                                        <p class="text-muted text-center mt-3">Bugün için yemek bulunamadı.</p>
                                                    <% } %>
                                                </div>

                                                <!-- Dilovası -->
                                                <div class="tab-pane" id="dilovasi">
                                                    <% if (todayMenuDilovasi) { %>
                                                        <ul class="list-group list-group-flush">
                                                            <% let foundSalad = false; %>
                                                            <% let saladIndex = -1; %>
                                                            <% todayMenuDilovasi.meals.forEach((meal, index) => { %>
                                                                <% if (meal.name === "SALATA VE ZEYTİNYAĞLI BÜFESİ") { %>
                                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                        <span class="clickable" data-bs-toggle="collapse" data-bs-target="#dropdown-dilovasi-<%= index %>" aria-expanded="false" aria-controls="dropdown-dilovasi-<%= index %>">
                                                                            <%= meal.name %>
                                                                        </span>
                                                                        <% if (meal.calorie) { %>
                                                                            <span class="badge bg-primary text-white"><%= meal.calorie %> kcal</span>
                                                                        <% } %>
                                                                    </li>
                                                                    <% foundSalad = true; saladIndex = index; %>
                                                                    <ul class="list-group list-group-flush collapse" id="dropdown-dilovasi-<%= index %>">
                                                                <% } else if (foundSalad) { %>
                                                                    <li class="list-group-item"><span><%= meal.name %></span></li>
                                                                <% } else { %>
                                                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                                                        <span><%= meal.name %></span>
                                                                        <% if (meal.calorie) { %>
                                                                            <span class="badge bg-primary text-white"><%= meal.calorie %> kcal</span>
                                                                        <% } %>
                                                                    </li>
                                                                <% } %>
                                                            <% }) %>
                                                            <% if (foundSalad) { %></ul><% } %>
                                                        </ul>
                                                    <% } else { %>
                                                        <p class="text-muted text-center mt-3">Bugün için yemek bulunamadı.</p>
                                                    <% } %>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <!-- Doğum Günü Bölümü -->
                                    <div class="birthday-section">
                                        <% if (birthdays.length> 0) { %>
                                            <div class="swiper mySwiper"
                                                style="width: 100%; height: auto; margin-top: 20px;">
                                                <div class="swiper-wrapper">
                                                    <% let index=1; %>
                                                        <% birthdays.forEach(kisi=> { %>
                                                            <div class="swiper-slide">
                                                                <div class="card cta-box text-white"
                                                                    style="background-color: #201750;">
                                                                    <div class="card-body">
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="w-100 overflow-hidden">
                                                                                <h3 class="m-0 fw-normal cta-box-title">
                                                                                    Doğum Günün Kutlu Olsun <b><br>
                                                                                        <%= kisi.Adi %>
                                                                                            <%= kisi.Soyadi %>
                                                                                    </b>!
                                                                                </h3>
                                                                                <h4>
                                                                                    <%= new
                                                                                        Date(kisi.DogumTarihi).toLocaleDateString('tr-TR',
                                                                                        { day: 'numeric' , month: 'long' })
                                                                                        %>
                                                                                </h4>
                                                                            </div>
                                                                            <a href="#" id="confettiButton<%= index %>"
                                                                                onclick="handleButtonClick(this)">
                                                                                <img class="ms-3" src="/uploads/pasta.png"
                                                                                    width="100" alt="Pasta">
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <% index++; %>
                                                                <% }); %>
                                                </div>
                                            </div>
                                            <% } %>
                                    </div>

                                    <!-- İşe Girenler Bölümü -->
                                    <div class="new-hires-section">
                                        <% if (newHires.length> 0) {
                                            const sortedNewHires = newHires.sort((a, b) => new
                                            Date(b.IsYeriGirisTarihi) - new Date(a.IsYeriGirisTarihi));
                                            %>
                                            <div class="card shadow-sm border-0 mb-3">
                                                <div class="card-header"><strong>Bu Hafta Başlayanlar</strong></div>
                                                <div class="card-body"
                                                    style="overflow-y: auto; max-height: 200px;">
                                                    <ul class="list-group list-group-flush">
                                                        <% sortedNewHires.forEach(person=> { %>
                                                            <li class="list-group-item d-flex align-items-start">
                                                                <i
                                                                    class="mdi mdi-account-plus text-success me-3 mt-1" style="font-size: 1.3em;"></i>
                                                                <div>
                                                                    <div><strong>
                                                                            <%= person.Adi %>
                                                                                <%= person.Soyadi %>
                                                                        </strong></div>
                                                                    <div class="text-muted">
                                                                        <%= person.Unvan %>
                                                                    </div>
                                                                    <div class="small text-secondary">
                                                                        Başlama Tarihi:
                                                                        <%= new
                                                                            Date(person.IsYeriGirisTarihi).toLocaleDateString('tr-TR',
                                                                            { day: 'numeric' , month: 'long' }) %>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                            <% }); %>
                                                    </ul>
                                                </div>
                                            </div>
                                            <% } else { %>
                                                <div class="card shadow-sm border-0 mb-4">
                                                    <div class="card-header"><strong>Bu Hafta Başlayanlar</strong>
                                                    </div>
                                                    <div class="card-body">
                                                        
                                                    </div>
                                                </div>
                                                <% } %>
                                    </div>

                                    <!-- İşten Çıkanlar Bölümü -->
                                    <div class="leavers-section">
                                        <% if (leavers.length> 0) {
                                            const sortedLeavers = leavers.sort((a, b) => new
                                            Date(b.CEMP_ENDDATE) - new Date(a.CEMP_ENDDATE));
                                            %>
                                            <div class="card shadow-sm border-0 mb-3">
                                                <div class="card-header"><strong>Şirketimizden
                                                        Ayrılanlar</strong></div>
                                                <div class="card-body"
                                                    style="overflow-y: auto; max-height: 200px;">
                                                    <ul class="list-group list-group-flush">
                                                        <% sortedLeavers.filter(person => person.SicilNo !== 1261 && person.SicilNo !== 2131 ).forEach(person => { %>
                                                            <li class="list-group-item d-flex align-items-start">
                                                                <i class="mdi mdi-account text-danger me-3 mt-1" style="font-size: 1.3em;"></i>
                                                                <div>
                                                                    <div><strong>
                                                                        <%= person.Adi %> <%= person.Soyadi %>
                                                                    </strong></div>
                                                                    <div class="text-muted">
                                                                        <%= person.Unvan %>
                                                                    </div>
                                                                    <div class="small text-secondary">
                                                                        Ayrılma Tarihi:
                                                                        <%= new Date(person.CEMP_ENDDATE).toLocaleDateString('tr-TR', {
                                                                            day: 'numeric',
                                                                            month: 'long'
                                                                        }) %>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        <% }); %>
                                                    </ul>
                                                </div>
                                            </div>
                                            <% } else { %>
                                                <div class="card shadow-sm border-0 mb-4">
                                                    <div class="card-header"><strong>Şirketimizden
                                                            Ayrılanlar</strong></div>
                                                    <div class="card-body">
                                                        
                                                    </div>
                                                </div>
                                                <% } %>
                                    </div>

                                </div>
                                <div class="col-lg-6 col-md-12 col-sm-12">
                                    <div id="slider" class="carousel slide carousel-fade" data-bs-ride="carousel">
                                        <div class="carousel-inner">
                                            <% 
                                                const aktifSliderlar = sliders.filter(s => s.isActive == 1);
                                                aktifSliderlar.forEach((slider, index) => { 
                                            %>
                                                <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                                                    <a target="_blank" href="<%= slider.link %>">
                                                        <img class="d-block img-fluid" src="<%= slider.imageUrl %>" style="width: 100%;">
                                                    </a>
                                                    <% if (slider.title || slider.description) { %>
                                                        <div class="carousel-caption"
                                                            style="background: radial-gradient(circle, rgba(0, 0, 0, 0.4) 40%, rgba(0, 0, 0, 0) 100%);">
                                                            <% if (slider.title) { %>
                                                                <h5><%= slider.title %></h5>
                                                            <% } %>
                                                            <% if (slider.description) { %>
                                                                <p><%= slider.description %></p>
                                                            <% } %>
                                                        </div>
                                                    <% } %>
                                                </div>
                                            <% }); %>
                                        </div>
                                    
                                        <a class="carousel-control-prev" href="#slider" role="button" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true" style="color: black;"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" href="#slider" role="button" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </a>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="card col-lg-12 mb-3 mt-3">
                                            <div class="card-header"><strong>Doküman Yönetim Sistemi</strong></div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-centered w-100 dt-responsive nowrap" id="docss-datatable">
                                                        <tbody>
                                                            <% 
                                                                // Aktif olanları filtrele ve count'a göre sırala
                                                                const sortedDocs = docs
                                                                    .filter(doc => doc.isActive) // sadece aktif olanlar
                                                                    .sort((a, b) => {
                                                                        const condition = true; // buraya koşul yazabilirsin
                                                                        return condition ? a.count - b.count : b.count - a.count;
                                                                    });
                                                            %>
                                        
                                                            <% if (sortedDocs.length === 0) { %>
                                                                <tr>
                                                                    <td colspan="2">Gösterilecek aktif döküman bulunamadı.</td>
                                                                </tr>
                                                            <% } else { %>
                                                                <% sortedDocs.forEach(doc => { %>
                                                                    <tr>
                                                                        <td width="90%">
                                                                            <%= doc.docName %>
                                                                        </td>
                                                                        <td width="10%">
                                                                            <a href="<%= doc.docLink %>" target="_blank">Tıklayınız...</a>
                                                                        </td>
                                                                    </tr>
                                                                <% }) %>
                                                            <% } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                    </div>
                                </div>

                                <!-- Bilgi Bankası -->

                                <!-- Yemek Listesi ve Hava Durumu -->
                                <div class="col-lg-3 col-md-12 col-sm-12">
                                    <div class="card mb-3 shadow-sm">
                                        <div class="card-header bg-primary text-white text-center">
                                            <strong>Açık Kapı Görüşmeleri</strong>
                                        </div>
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <!-- Açıklama Kısmı -->
                                                <div class="col-md-7">
                                                    <p class="card-text">Açık Kapı görüşmeleri ile birebir toplantı planlayabilirsiniz.</p>
                                                    <a target="_blank"
                                                        href="https://outlook.office.com/bookwithme/user/c162046cd85940d3ad762eadbf5bd25f@boltas.com/meetingtype/C5CH207_skSdw-5jcVM8Kw2?anonymous&ismsaljsauthenabled&ep=mcard"
                                                        class="btn btn-primary">
                                                        Randevu Al
                                                    </a>
                                                </div>
                                                <!-- Görsel Kısmı -->
                                                <div class="col-md-5 text-center">
                                                    <img src="/uploads/acik-kapi.png" class="img-fluid" width="160"
                                                        alt="Açık Kapı">
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card mb-3">
                                        <div class="card-header"><strong>Hava Durumu</strong></div>
                                        <div class="card-body">
                                            <label for="citySelect" class="form-label">Şehir Seçin:</label>
                                            <select class="form-select" id="citySelect">
                                                <option selected value="">Lütfen bir şehir seçin</option>
                                                <option value="Istanbul">İstanbul</option>
                                                <option value="Ankara">Ankara</option>
                                                <option value="İzmir">İzmir</option>
                                                <option value="Adana">Adana</option>
                                                <option value="Nürnberg">Nürnberg</option>
                                                <option value="Trieste">Trieste</option>
                                                <option value="Willich">Willich</option>
                                                <option value="Bucuresti">Bucuresti</option>
                                                <option value="Akyaka">Akyaka</option>
                                                <option value="Hamzabeyli">Hamzabeyli</option>
                                                <option value="Edirne">Kapıkule</option>
                                            </select>
                                            <div id="weather-info" class="mt-3"></div>
                                        </div>
                                    </div>
                                    <div class="card mb-3">
                                        <div class="card-header"><strong>Döviz Kurları</strong></div>
                                        <div class="card-body">
                                            <table class="table table-sm">
                                                <thead>
                                                    <tr>
                                                        <th>Döviz Kodu</th>
                                                        <th>Alış Fiyatı (TL)</th>
                                                        <th>Satış Fiyatı (TL)</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% currencies.forEach(currency=> { %>
                                                        <% if (['USD', 'EUR' , 'GBP' ].includes(currency.currencyCode))
                                                            { %>
                                                            <tr>
                                                                <td>
                                                                    <i class="uil uil-<%= currency.currencyCode %>"
                                                                        style="color: #759e6f;"></i>&nbsp;&nbsp;<%= currency.currencyCode %>
                                                                </td>
                                                                <td>
                                                                    <%= currency.forexBuying %>
                                                                </td>
                                                                <td>
                                                                    <%= currency.forexSelling %>
                                                                </td>
                                                            </tr>
                                                            <% } %>
                                                        <% }) %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end row -->
                        </div>
                        <!-- container -->

            </div>
            <!-- content -->

            <!-- Footer Start -->
            <%- include("partials/footer") %>
                <!-- end Footer -->

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->


    </div>
    <!-- END wrapper -->

    <!-- Mesajlaşma widget'ını ekleme -->
    <% if (currentPath !== '/login' && !currentPath.startsWith('/ikyonetim')) { %>
        <%- include("partials/message-widget") %>
    <% } %>

    <%- include("partials/scripts") %>

</body>

</html>
