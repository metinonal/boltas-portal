<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="utf-8">
    <title><%= title %> | Boltas Portal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Boltas Portal Pazaryeri" name="description">

    <%- include("../partials/css") %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.css">
    <link href="/admin-assets/css/style.css" rel="stylesheet" type="text/css" />
</head>

<body class="loading" data-layout-color="light" data-layout="topnav" data-layout-mode="fluid" data-rightbar-onstart="true">
    <!-- Begin page -->
    <div class="wrapper">

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="content">
                <!-- Topbar Start -->
                <%- include("../partials/topbar") %>
                <!-- end Topbar -->

                <%- include("../partials/topnav") %>

                <!-- Start Content-->
                <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <h4 class="page-title"><%= category %> Kategorisi</h4>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row">
                        <!-- Sol Sütun: Kategoriler ve Butonlar -->
                        <div class="col-md-3">
                            <!-- Butonlar -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <a href="/pazaryeri/urun-ekle" class="btn btn-primary">
                                            <i class="mdi mdi-plus-circle me-1"></i> Ürün Ekle
                                        </a>
                                        <a href="/pazaryeri/urunlerim" class="btn btn-info">
                                            <i class="mdi mdi-format-list-bulleted me-1"></i> Ürünlerim
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Arama Butonu -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="input-group">
                                     <input type="text" class="form-control" id="search-input" placeholder="Ürün ara..." value="<%= locals.search ? search : '' %>">
                                     <button class="btn btn-primary" type="button" id="search-button">
                                         <i class="mdi mdi-magnify"></i>
                                     </button>
                                </div>
                                </div>
                            </div>

                            <!-- Kategoriler -->
                            <div class="card category-sidebar">
                                <div class="card-body">
                                    <h5 class="card-title mb-3">Kategoriler</h5>
                                    
                                    <a href="/pazaryeri" class="text-decoration-none">
                                        <div class="category-item <%= !locals.category ? 'active' : '' %>">
                                            <i class="mdi mdi-view-grid text-primary"></i>
                                            <span>Tüm Ürünler</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Elektronik" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Elektronik' ? 'active' : '' %>">
                                            <i class="mdi mdi-laptop text-danger"></i>
                                            <span>Elektronik</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Mobilya" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Mobilya' ? 'active' : '' %>">
                                            <i class="mdi mdi-sofa text-success"></i>
                                            <span>Mobilya</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Giyim" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Giyim' ? 'active' : '' %>">
                                            <i class="mdi mdi-tshirt-crew text-info"></i>
                                            <span>Giyim</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Kitap" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Kitap' ? 'active' : '' %>">
                                            <i class="mdi mdi-book-open-page-variant text-warning"></i>
                                            <span>Kitap</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Spor" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Spor' ? 'active' : '' %>">
                                            <i class="mdi mdi-basketball text-danger"></i>
                                            <span>Spor</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Otomotiv" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Otomotiv' ? 'active' : '' %>">
                                            <i class="mdi mdi-car text-primary"></i>
                                            <span>Otomotiv</span>
                                        </div>
                                    </a>
                                    
                                    <a href="/pazaryeri/kategori/Diğer" class="text-decoration-none">
                                        <div class="category-item <%= category === 'Diğer' ? 'active' : '' %>">
                                            <i class="mdi mdi-dots-horizontal text-secondary"></i>
                                            <span>Diğer</span>
                                        </div>
                                    </a>
                                </div>
                            </div>

                            <form id="filter-form" method="GET" action="">
                                <!-- Fiyat Aralığı Filtresi -->
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">Fiyat Aralığı</h5>
                                        <div id="price-range" class="price-slider mb-3"></div>
                                        
                                        <!-- Fiyat input alanları -->
                                        <div class="row mt-3">
                                            <div class="col-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">₺</span>
                                                    <input type="number" class="form-control" id="price-min-input" 
                                                           min="0" max="10000" step="1" 
                                                           value="<%= locals.filters ? filters.minPrice : 0 %>" 
                                                           placeholder="Min">
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">₺</span>
                                                    <input type="number" class="form-control" id="price-max-input" 
                                                           min="0" max="10000" step="1" 
                                                           value="<%= locals.filters ? filters.maxPrice : 10000 %>" 
                                                           placeholder="Max">
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <input type="hidden" name="minPrice" id="minPrice" value="<%= locals.filters ? filters.minPrice : 0 %>">
                                        <input type="hidden" name="maxPrice" id="maxPrice" value="<%= locals.filters ? filters.maxPrice : 10000 %>">
                                    </div>
                                </div>

                                <!-- Durum Filtresi - Dropdown Yapıda -->
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="card-title mb-0">Ürün Durumu</h5>
                                            <button class="btn btn-sm btn-link p-0 condition-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#conditionFilterCollapse" aria-expanded="false" aria-controls="conditionFilterCollapse">
                                                <i class="mdi mdi-chevron-down"></i>
                                            </button>
                                        </div>
                                        <div class="collapse" id="conditionFilterCollapse">
                                            <div class="condition-filter-container" style="max-height: 200px; overflow-y: auto;">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Yeni" id="condition-new" 
                                                        <%= locals.filters && filters.conditions.includes('Yeni') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-new">
                                                        <strong>Yeni</strong>
                                                        <small class="d-block text-muted">Hiç kullanılmamış, orijinal ambalajında</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Yeni Gibi" id="condition-like-new"
                                                        <%= locals.filters && filters.conditions.includes('Yeni Gibi') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-like-new">
                                                        <strong>Yeni Gibi</strong>
                                                        <small class="d-block text-muted">Neredeyse hiç kullanılmamış, mükemmel durumda</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Çok İyi" id="condition-very-good"
                                                        <%= locals.filters && filters.conditions.includes('Çok İyi') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-very-good">
                                                        <strong>Çok İyi</strong>
                                                        <small class="d-block text-muted">Çok az kullanılmış, belirgin aşınma yok</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="İyi" id="condition-good"
                                                        <%= locals.filters && filters.conditions.includes('İyi') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-good">
                                                        <strong>İyi</strong>
                                                        <small class="d-block text-muted">Kullanılmış ancak iyi durumda</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Orta" id="condition-fair"
                                                        <%= locals.filters && filters.conditions.includes('Orta') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-fair">
                                                        <strong>Orta</strong>
                                                        <small class="d-block text-muted">Kullanım izleri var, işlevsel</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Kullanılmış" id="condition-used"
                                                        <%= locals.filters && filters.conditions.includes('Kullanılmış') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-used">
                                                        <strong>Kullanılmış</strong>
                                                        <small class="d-block text-muted">Genel kullanılmış durum</small>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input condition-filter" type="checkbox" name="conditions" value="Yenilenmiş" id="condition-refurbished"
                                                        <%= locals.filters && filters.conditions.includes('Yenilenmiş') ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="condition-refurbished">
                                                        <strong>Yenilenmiş</strong>
                                                        <small class="d-block text-muted">Onarılmış veya yenilenmiş</small>
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="d-flex mt-3">
                                                <button type="button" id="select-all-conditions" class="btn btn-sm btn-outline-secondary me-2 flex-grow-1">Tümünü Seç</button>
                                                <button type="button" id="clear-all-conditions" class="btn btn-sm btn-outline-secondary flex-grow-1">Temizle</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Konum Filtresi -->
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h5 class="card-title mb-0">Konum</h5>
                                            <button class="btn btn-sm btn-link p-0 location-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#locationFilterCollapse" aria-expanded="false" aria-controls="locationFilterCollapse">
                                                <i class="mdi mdi-chevron-down"></i>
                                            </button>
                                        </div>
                                        <div class="collapse" id="locationFilterCollapse">
                                            <div class="location-filter-container" style="max-height: 200px; overflow-y: auto;">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="Tümü" id="location-all"
                                                        <%= !locals.filters || filters.location === 'Tümü' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-all">
                                                        <strong>Tümü</strong>
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="İstanbul" id="location-istanbul"
                                                        <%= locals.filters && filters.location === 'İstanbul' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-istanbul">
                                                        İstanbul
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="Ankara" id="location-ankara"
                                                        <%= locals.filters && filters.location === 'Ankara' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-ankara">
                                                        Ankara
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="İzmir" id="location-izmir"
                                                        <%= locals.filters && filters.location === 'İzmir' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-izmir">
                                                        İzmir
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="Bursa" id="location-bursa"
                                                        <%= locals.filters && filters.location === 'Bursa' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-bursa">
                                                        Bursa
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="Antalya" id="location-antalya"
                                                        <%= locals.filters && filters.location === 'Antalya' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-antalya">
                                                        Antalya
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input location-filter" type="radio" name="location" value="Diğer" id="location-other"
                                                        <%= locals.filters && filters.location === 'Diğer' ? 'checked' : '' %>>
                                                    <label class="form-check-label" for="location-other">
                                                        Diğer
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Sıralama (gizli input) -->
                                <input type="hidden" name="sort" id="sort-input" value="<%= locals.sort ? sort : 'newest' %>">
                                
                                <!-- Sayfa (gizli input) -->
                                <input type="hidden" name="page" id="page-input" value="1">

                                <!-- Arama (gizli input) -->
                                <input type="hidden" name="search" id="search-hidden" value="<%= locals.search ? search : '' %>">
                                
                                <!-- Filtre Uygula Butonu -->
                                <div class="card mt-3">
                                    <div class="card-body">
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="mdi mdi-filter-outline me-1"></i> Filtreleri Uygula
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- Sağ Sütun: Sıralama ve Ürünler -->
                        <div class="col-md-9">
                            <!-- Sıralama Seçenekleri -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-md-12">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div>
                                                    <span class="text-muted me-2">Toplam <span id="product-count"><%= pagination.totalProducts %></span> ürün</span>
                                                </div>
                                                <div class="dropdown sort-dropdown">
                                                    <button class="btn btn-light dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                                        <i class="mdi mdi-sort"></i> 
                                                        <% if (locals.sort) { %>
                                                            <% if (sort === 'newest') { %>En Yeni<% } %>
                                                            <% if (sort === 'oldest') { %>En Eski<% } %>
                                                            <% if (sort === 'price-asc') { %>Fiyat (Düşükten Yükseğe)<% } %>
                                                            <% if (sort === 'price-desc') { %>Fiyat (Yüksekten Düşüğe)<% } %>
                                                            <% if (sort === 'name-asc') { %>İsim (A-Z)<% } %>
                                                            <% if (sort === 'name-desc') { %>İsim (Z-A)<% } %>
                                                        <% } else { %>
                                                            Sırala
                                                        <% } %>
                                                    </button>
                                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortDropdown">
                                                        <li><a class="dropdown-item sort-option" data-sort="newest" href="#"><i class="mdi mdi-sort-calendar-descending"></i> En Yeni</a></li>
                                                        <li><a class="dropdown-item sort-option" data-sort="oldest" href="#"><i class="mdi mdi-sort-calendar-ascending"></i> En Eski</a></li>
                                                        <li><a class="dropdown-item sort-option" data-sort="price-asc" href="#"><i class="mdi mdi-sort-numeric-ascending"></i> Fiyat (Düşükten Yükseğe)</a></li>
                                                        <li><a class="dropdown-item sort-option" data-sort="price-desc" href="#"><i class="mdi mdi-sort-numeric-descending"></i> Fiyat (Yüksekten Düşüğe)</a></li>
                                                        <li><a class="dropdown-item sort-option" data-sort="name-asc" href="#"><i class="mdi mdi-sort-alphabetical-ascending"></i> İsim (A-Z)</a></li>
                                                        <li><a class="dropdown-item sort-option" data-sort="name-desc" href="#"><i class="mdi mdi-sort-alphabetical-descending"></i> İsim (Z-A)</a></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ürünler -->
                            <div class="row" id="products-container">
                                <% if (products.length === 0) { %>
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body empty-state">
                                                <i class="mdi mdi-store-outline empty-state-icon"></i>
                                                <h4 class="empty-state-title">Bu kategoride henüz ürün bulunmuyor</h4>
                                                <p class="empty-state-text">İlk ürünü ekleyen siz olun!</p>
                                                <a href="/pazaryeri/urun-ekle" class="btn btn-primary mt-2">
                                                    <i class="mdi mdi-plus-circle me-1"></i> Ürün Ekle
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                <% } else { %>
                                    <% products.forEach(product => { %>
                                        <div class="col-md-6 col-lg-4 mb-4 product-item">
                                            <div class="card product-card h-100">
                                                <div class="product-img-container">
                                                    <% if (product.images && product.images.length > 0) { %>
                                                        <img src="<%= product.images[0] %>" class="product-img" alt="<%= product.title %>">
                                                    <% } else { %>
                                                        <img src="/uploads/no-image.png" class="product-img" alt="Resim Yok">
                                                    <% } %>
                                                    <span class="badge bg-primary category-badge"><%= product.category %></span>
                                                </div>
                                                <div class="card-body d-flex flex-column">
                                                    <h5 class="card-title text-truncate"><%= product.title %></h5>
                                                    <p class="card-text text-truncate mb-2"><%= product.description %></p>
                                                    <div class="mt-auto">
                                                        <div class="d-flex justify-content-between align-items-center">
                                                            <span class="text-primary fw-bold"><%= product.price.toLocaleString('tr-TR') %> ₺</span>
                                                            <span class="badge bg-light text-dark"><%= product.condition %></span>
                                                        </div>
                                                        <div class="d-flex justify-content-between align-items-center mt-2">
                                                            <small class="text-muted"><i class="mdi mdi-map-marker"></i> <%= product.location %></small>
                                                            <small class="text-muted"><i class="mdi mdi-eye"></i> <%= product.viewCount %></small>
                                                        </div>
                                                        <a href="/pazaryeri/urun/<%= product._id %>" class="btn btn-outline-primary w-100 mt-3">Detayları Gör</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    <% }) %>
                                <% } %>
                            </div>

                            <!-- Pagination -->
                            <% if (pagination.totalPages > 1) { %>
                                <div class="row mt-4">
                                    <div class="col-12">
                                        <nav aria-label="Page navigation">
                                            <ul class="pagination justify-content-center">
                                                <% if (pagination.page > 1) { %>
                                                    <li class="page-item">
                                                        <a class="page-link pagination-link" href="#" data-page="<%= pagination.page - 1 %>" aria-label="Previous">
                                                            <span aria-hidden="true">&laquo;</span>
                                                        </a>
                                                    </li>
                                                <% } else { %>
                                                    <li class="page-item disabled">
                                                        <a class="page-link" href="#" aria-label="Previous">
                                                            <span aria-hidden="true">&laquo;</span>
                                                        </a>
                                                    </li>
                                                <% } %>

                                                <% 
                                                    let startPage = Math.max(1, pagination.page - 2);
                                                    let endPage = Math.min(pagination.totalPages, pagination.page + 2);
                                                    
                                                    // Ensure we always show 5 pages if possible
                                                    if (endPage - startPage < 4) {
                                                        if (startPage === 1) {
                                                            endPage = Math.min(5, pagination.totalPages);
                                                        } else {
                                                            startPage = Math.max(1, pagination.totalPages - 4);
                                                        }
                                                    }
                                                %>

                                                <% for (let i = startPage; i <= endPage; i++) { %>
                                                    <li class="page-item <%= pagination.page === i ? 'active' : '' %>">
                                                        <a class="page-link pagination-link" href="#" data-page="<%= i %>"><%= i %></a>
                                                    </li>
                                                <% } %>

                                                <% if (pagination.page < pagination.totalPages) { %>
                                                    <li class="page-item">
                                                        <a class="page-link pagination-link" href="#" data-page="<%= pagination.page + 1 %>" aria-label="Next">
                                                            <span aria-hidden="true">&raquo;</span>
                                                        </a>
                                                    </li>
                                                <% } else { %>
                                                    <li class="page-item disabled">
                                                        <a class="page-link" href="#" aria-label="Next">
                                                            <span aria-hidden="true">&raquo;</span>
                                                        </a>
                                                    </li>
                                                <% } %>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    <!-- end row -->
                </div>
                <!-- container -->
            </div>
            <!-- content -->

            <!-- Footer Start -->
            <%- include("../partials/footer") %>
            <!-- end Footer -->
        </div>
        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->
    </div>
    <!-- END wrapper -->

    <%- include("../partials/scripts") %>
    <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.js"></script>

    <script>
        $(document).ready(function() {
            // Fiyat aralığı slider'ı
            var priceSlider = document.getElementById('price-range');
            var minPrice = <%= locals.filters ? filters.minPrice : 0 %>;
            var maxPrice = <%= locals.filters ? filters.maxPrice : 10000 %>;
        
            if (priceSlider) {
                noUiSlider.create(priceSlider, {
                    start: [minPrice, maxPrice],
                    connect: true,
                    step: 1,
                    range: {
                        'min': 0,
                        'max': 10000
                    },
                    format: {
                        to: function (value) {
                            return parseInt(value);
                        },
                        from: function (value) {
                            return parseInt(value);
                        }
                    }
                });
            
                // Slider değerleri değiştiğinde göstergeleri ve input'ları güncelle
                priceSlider.noUiSlider.on('update', function (values, handle) {
                    // Hidden input'ları güncelle
                    document.getElementById('minPrice').value = values[0];
                    document.getElementById('maxPrice').value = values[1];
                
                    // Input alanlarını güncelle
                    document.getElementById('price-min-input').value = values[0];
                    document.getElementById('price-max-input').value = values[1];
                });
            
                // Min input değiştiğinde doğrudan hidden input'a değeri yaz
                $('#price-min-input').on('change', function() {
                    var minValue = parseInt($(this).val());
                    var maxValue = parseInt($('#price-max-input').val());

                    // Min değer max değerden büyükse, max değeri min değere eşitle
                    if (minValue > maxValue) {
                        maxValue = minValue;
                        $('#price-max-input').val(maxValue);
                        $('#maxPrice').val(maxValue);
                    }

                    // Doğrudan hidden input'a değeri yaz
                    $('#minPrice').val(minValue);
                    
                    // Slider'ı güncelle ama yuvarlama olmadan
                    if (priceSlider) {
                        priceSlider.noUiSlider.set([minValue, null]);
                    }
                });

                // Max input değiştiğinde doğrudan hidden input'a değeri yaz
                $('#price-max-input').on('change', function() {
                    var maxValue = parseInt($(this).val());
                    var minValue = parseInt($('#price-min-input').val());

                    // Max değer min değerden küçükse, min değeri max değere eşitle
                    if (maxValue < minValue) {
                        minValue = maxValue;
                        $('#price-min-input').val(minValue);
                        $('#minPrice').val(minValue);
                    }

                    // Doğrudan hidden input'a değeri yaz
                    $('#maxPrice').val(maxValue);
                    
                    // Slider'ı güncelle ama yuvarlama olmadan
                    if (priceSlider) {
                        priceSlider.noUiSlider.set([null, maxValue]);
                    }
                });
            }
        
            // Dropdown ikonlarını değiştir
            $('.condition-toggle, .location-toggle').on('click', function() {
                const icon = $(this).find('i');
                if (icon.hasClass('mdi-chevron-down')) {
                    icon.removeClass('mdi-chevron-down').addClass('mdi-chevron-up');
                } else {
                    icon.removeClass('mdi-chevron-up').addClass('mdi-chevron-down');
                }
            });
        
            // Tüm durum filtrelerini seç
            $('#select-all-conditions').on('click', function() {
                $('.condition-filter').prop('checked', true);
            });
        
            // Tüm durum filtrelerini temizle
            $('#clear-all-conditions').on('click', function() {
                $('.condition-filter').prop('checked', false);
            });
        
            // Sıralama işlevselliği
            $('.sort-option').on('click', function(e) {
                e.preventDefault();
                const sortText = $(this).text();
                const sortValue = $(this).data('sort');
                $('#sortDropdown').html('<i class="mdi mdi-sort"></i> ' + sortText);
                $('#sort-input').val(sortValue);
                $('#filter-form').submit();
            });
        
            // Sayfalama işlevselliği
            $('.pagination-link').on('click', function(e) {
                e.preventDefault();
                const page = $(this).data('page');
                $('#page-input').val(page);
                $('#filter-form').submit();
            });

            // Arama işlevselliği
            $('#search-button').on('click', function() {
                const searchValue = $('#search-input').val().trim();
                $('#search-hidden').val(searchValue);
                $('#filter-form').submit();
            });

            // Enter tuşuna basıldığında arama yap
            $('#search-input').on('keypress', function(e) {
                if (e.which === 13) {
                    const searchValue = $(this).val().trim();
                    $('#search-hidden').val(searchValue);
                    $('#filter-form').submit();
                }
            });
        });
    </script>
</body>
</html>
