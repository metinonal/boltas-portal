<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="utf-8">
  <title>Profilim | Boltas Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
  <meta content="Coderthemes" name="author">

  <%- include("partials/css") %>

</head>

<body class="loading" data-layout-color="light" data-layout="topnav" data-layout-mode="fluid"
  data-rightbar-onstart="true">
  <!-- Begin page -->
  <div class="wrapper">

    <!-- ============================================================== -->
    <!-- Start Page Content here -->
    <!-- ============================================================== -->

    <div class="content-page">
      <div class="content">
        <!-- Topbar Start -->
        <%- include("partials/topbar") %>
          <!-- end Topbar -->

          <%- include("partials/topnav") %>

            <!-- Start Content-->
            <div class="container-fluid">

              <!-- start page title -->
              <div class="row">
                <div class="col-12">
                  <div class="page-title-box">
                    <h4 class="page-title">Profilim</h4>
                  </div>
                </div>
              </div>
              <!-- end page title -->

              <div class="row">
                <div class="col-12">
                  <!-- Profile Header Card -->
                  <div class="card">
                    <div class="card-body">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <img src="uploads/pphotos/<%= user.EMail %>.png" 
                               class="rounded-circle avatar-xl img-thumbnail shadow-sm" 
                               alt="profile-image"
                               style="width: 120px; height: 120px; object-fit: cover;"
                               onerror="this.src='uploads/pphotos/default.jpg'">
                        </div>
                        <div class="col">
                          <h3 class="mb-1 text-dark">
                            <%= user.displayName?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                          </h3>
                          <p class="text-muted mb-2 fs-5">
                            <%= user.Unvan?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                          </p>
                          <div class="row">
                            <div class="col-md-6">
                              <p class="text-muted mb-1">
                                <i class="mdi mdi-email-outline me-1"></i>
                                <%= user.EMail %>
                              </p>
                              <p class="text-muted mb-1">
                                <i class="mdi mdi-office-building me-1"></i>
                                <%= user.Organizasyon?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                              </p>
                            </div>
                            <div class="col-md-6">
                              <p class="text-muted mb-1">
                                <i class="mdi mdi-account-group me-1"></i>
                                <%= user.Departman?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                              </p>
                              <p class="text-muted mb-1">
                                <i class="mdi mdi-map-marker me-1"></i>
                                <%= user.LOKASYON?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Tabs -->
                  <div class="card">
                    <div class="card-body p-0">
                      <!-- Nav tabs -->
                      <ul class="nav nav-tabs nav-bordered" id="profileTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                          <button class="nav-link active" id="personal-info-tab" data-bs-toggle="tab" 
                                  data-bs-target="#personal-info" type="button" role="tab" 
                                  aria-controls="personal-info" aria-selected="true">
                            <i class="mdi mdi-account-circle me-1"></i>
                            Kişisel Bilgiler
                          </button>
                        </li>
                        <li class="nav-item" role="presentation">
                          <button class="nav-link" id="zimmet-tab" data-bs-toggle="tab" 
                                  data-bs-target="#zimmet" type="button" role="tab" 
                                  aria-controls="zimmet" aria-selected="false">
                            <i class="mdi mdi-package-variant me-1"></i>
                            Zimmetlerim
                            <% if (zimmetler && zimmetler.length > 0) { %>
                              <span class="badge bg-primary ms-1"><%= zimmetler.length %></span>
                            <% } %>
                          </button>
                        </li>
                      </ul>

                      <!-- Tab panes -->
                      <div class="tab-content p-3">
                        <!-- Personal Info Tab -->
                        <div class="tab-pane fade show active" id="personal-info" role="tabpanel" 
                             aria-labelledby="personal-info-tab">
  <div class="row g-4">
    <div class="col-md-6">
      <div class="card border-0 bg-light h-100">
        <div class="card-body p-4">
          <h6 class="text-primary mb-3">
            <i class="mdi mdi-account-circle me-2"></i>
            Kişisel Bilgiler
          </h6>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Email Adresi</label>
            <p class="mb-0 fw-medium"><%= user.EMail %></p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Doğum Tarihi</label>
            <p class="mb-0 fw-medium">
              <%= new Date(user.DogumTarihi).toLocaleDateString('tr-TR') %>
            </p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Yaka Rengi</label>
            <p class="mb-0 fw-medium">
              <%= user.YakaRengi?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">İşe Başlama Tarihi</label>
            <p class="mb-0 fw-medium">
              <%= new Date(user.IsYeriGirisTarihi).toLocaleDateString('tr-TR') %>
            </p>
          </div>
          
          <div class="mb-0">
            <label class="form-label fw-semibold text-muted small">Öğrenim Seviyesi</label>
            <p class="mb-0 fw-medium">
              <%= user.OgrenimSeviyesi?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="card border-0 bg-light h-100">
        <div class="card-body p-4">
          <h6 class="text-primary mb-3">
            <i class="mdi mdi-office-building me-2"></i>
            Organizasyon Bilgileri
          </h6>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Organizasyon</label>
            <p class="mb-0 fw-medium">
              <%= user.Organizasyon?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Departman</label>
            <p class="mb-0 fw-medium">
              <%= user.Departman?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">Ünvan Grubu</label>
            <p class="mb-0 fw-medium">
              <%= user.UnvanGrubu?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
          
          <div class="mb-3">
            <label class="form-label fw-semibold text-muted small">İş Yeri</label>
            <p class="mb-0 fw-medium">
              <%= user.IsyeriKisaAdi?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
          
          <div class="mb-0">
            <label class="form-label fw-semibold text-muted small">Lokasyon</label>
            <p class="mb-0 fw-medium">
              <%= user.LOKASYON?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-12">
      <div class="card border-0 bg-light">
        <div class="card-body p-4">
          <h6 class="text-primary mb-3">
            <i class="mdi mdi-account-supervisor me-2"></i>
            Yönetici Bilgileri
          </h6>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label fw-semibold text-muted small">Bağlı Olduğu Yönetici</label>
                <p class="mb-0 fw-medium">
                  <%= user.RaporlandigiYonetici?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
                </p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label fw-semibold text-muted small">Yönetici E-Mail</label>
                <p class="mb-0 fw-medium"><%= user.RaporlandigiYoneticiEMail %></p>
              </div>
            </div>
          </div>
          
          <div class="mb-0">
            <label class="form-label fw-semibold text-muted small">Üst Organizasyon</label>
            <p class="mb-0 fw-medium">
              <%= user.UstOrganizasyon?.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()).join(' ') %>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

                        <!-- Zimmet Tab -->
<div class="tab-pane fade" id="zimmet" role="tabpanel" aria-labelledby="zimmet-tab">
  <% if (zimmetler && zimmetler.length > 0) { %>
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h5 class="mb-1">
              <i class="mdi mdi-package-variant me-2 text-primary"></i>
              Zimmetli Ürünlerim
            </h5>
            <p class="text-muted mb-0">Üzerinize kayıtlı ürünlerin listesi</p>
          </div>
          <div class="text-end">
            <button type="button" class="btn btn-outline-primary me-2" onclick="printZimmetForm()">
              <i class="mdi mdi-printer me-1"></i>
              Zimmet Formunu Yazdır
            </button>
            <span class="badge bg-primary-subtle text-primary fs-6 px-3 py-2">
              <i class="mdi mdi-package me-1"></i>
              <%= zimmetler.length %> Ürün
            </span>
          </div>
        </div>
        
        <div class="card border-0 shadow-sm">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th scope="col" class="border-0 py-3 px-4">
                      <div class="d-flex align-items-center">
                        <i class="mdi mdi-format-list-numbered text-muted me-2"></i>
                        <span class="fw-semibold text-dark">#</span>
                      </div>
                    </th>
                    <th scope="col" class="border-0 py-3">
                      <div class="d-flex align-items-center">
                        <i class="mdi mdi-laptop text-muted me-2"></i>
                        <span class="fw-semibold text-dark">Ürün</span>
                      </div>
                    </th>
                    <th scope="col" class="border-0 py-3">
                      <div class="d-flex align-items-center">
                        <i class="mdi mdi-tag text-muted me-2"></i>
                        <span class="fw-semibold text-dark">Marka</span>
                      </div>
                    </th>
                    <th scope="col" class="border-0 py-3">
                      <div class="d-flex align-items-center">
                        <i class="mdi mdi-cube-outline text-muted me-2"></i>
                        <span class="fw-semibold text-dark">Model</span>
                      </div>
                    </th>
                    <th scope="col" class="border-0 py-3">
                      <div class="d-flex align-items-center">
                        <i class="mdi mdi-barcode text-muted me-2"></i>
                        <span class="fw-semibold text-dark">Seri No</span>
                      </div>
                    </th>
                    <th scope="col" class="border-0 py-3 text-center">
                      <div class="d-flex align-items-center justify-content-center">
                        <i class="mdi mdi-check-circle text-muted me-2"></i>
                        <span class="fw-semibold text-dark">Durum</span>
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <% zimmetler.forEach((zimmet, index) => { %>
                    <tr class="border-bottom">
                      <td class="py-3 px-4">
                        <div class="d-flex align-items-center">
                          <div class="avatar-sm bg-primary-subtle rounded-circle d-flex align-items-center justify-content-center me-2">
                            <span class="text-primary fw-bold small"><%= index + 1 %></span>
                          </div>
                        </div>
                      </td>
                      <td class="py-3">
                        <div class="d-flex align-items-center">
                          <div class="avatar-sm bg-info-subtle rounded me-3 d-flex align-items-center justify-content-center">
                            <i class="mdi mdi-laptop text-info"></i>
                          </div>
                          <div>
                            <h6 class="mb-0 fw-semibold text-dark">
                              <%= zimmet.Ürün || 'Ürün Adı Belirtilmemiş' %>
                            </h6>
                          </div>
                        </div>
                      </td>
                      <td class="py-3">
                        <span class="fw-medium text-dark">
                          <%= zimmet.Marka || '-' %>
                        </span>
                      </td>
                      <td class="py-3">
                        <span class="fw-medium text-dark">
                          <%= zimmet.Model || '-' %>
                        </span>
                      </td>
                      <td class="py-3">
                        <% if (zimmet.SeriNo) { %>
                          <code class="bg-light text-dark px-2 py-1 rounded border">
                            <%= zimmet.SeriNo %>
                          </code>
                        <% } else { %>
                          <span class="text-muted">-</span>
                        <% } %>
                      </td>
                      <td class="py-3 text-center">
                        <span class="badge bg-success-subtle text-success px-3 py-2">
                          <i class="mdi mdi-check-circle me-1"></i>
                          Aktif
                        </span>
                      </td>
                    </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <!-- Özet Bilgi -->
        <div class="row mt-4">
          <div class="col-md-4">
            <div class="card bg-primary-subtle border-0">
              <div class="card-body text-center py-3">
                <i class="mdi mdi-package-variant text-primary fs-3 mb-2"></i>
                <h5 class="text-primary mb-0"><%= zimmetler.length %></h5>
                <small class="text-muted">Toplam Zimmet</small>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-success-subtle border-0">
              <div class="card-body text-center py-3">
                <i class="mdi mdi-check-circle text-success fs-3 mb-2"></i>
                <h5 class="text-success mb-0"><%= zimmetler.length %></h5>
                <small class="text-muted">Aktif Zimmet</small>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card bg-info-subtle border-0">
              <div class="card-body text-center py-3">
                <i class="mdi mdi-calendar-clock text-info fs-3 mb-2"></i>
                <h5 class="text-info mb-0">0</h5>
                <small class="text-muted">Bekleyen İşlem</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% } else { %>
    <div class="text-center py-5">
      <div class="mb-4">
        <div class="avatar-xl bg-light rounded-circle mx-auto d-flex align-items-center justify-content-center">
          <i class="mdi mdi-package-variant-closed text-muted" style="font-size: 3rem;"></i>
        </div>
      </div>
      <h5 class="text-muted mb-2">Zimmetli Ürün Bulunamadı</h5>
      <p class="text-muted mb-4">Şu anda üzerinize kayıtlı herhangi bir zimmetli ürün bulunmamaktadır.</p>
      <div class="bg-light rounded p-4 mx-auto" style="max-width: 400px;">
        <div class="d-flex align-items-center">
          <i class="mdi mdi-information-outline text-info me-2"></i>
          <small class="text-muted mb-0">
            Zimmet işlemleri için BT departmanı ile iletişime geçebilirsiniz.
          </small>
        </div>
      </div>
    </div>
  <% } %>
</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end row-->

            </div>
            <!-- container -->

          </div>
          <!-- content -->

          <!-- Footer Start -->
          <%- include("partials/footer") %>
          <!-- end Footer -->

      </div>

      <!-- ============================================================== -->
      <!-- End Page content -->
      <!-- ============================================================== -->

    </div>
    <!-- END wrapper -->

    <%- include("partials/scripts") %>
    <script>
function printZimmetForm() {
  const user = <%- JSON.stringify(user) %>;
  const zimmetler = <%- JSON.stringify(zimmetler) %>;

  const printWindow = window.open('', '_blank', 'width=900,height=1000');
  const today = new Date().toLocaleDateString('tr-TR');
  const formNo = 'ZMT' + new Date().toISOString().slice(0, 10).replace(/-/g, '');

  const html = `
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Zimmet Formu</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, sans-serif;
      font-size: 11px;
      color: #000;
    }
    .wrapper {
      min-height: 100%;
      display: flex;
      flex-direction: column;
    }
    .content {
      padding: 20px;
    }
    h1 {
      font-size: 16px;
      font-weight: bold;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
    }
    .logo {
      text-align: right;
    }
    .info-table {
      margin-top: 20px;
      width: 100%;
    }
    .info-table td {
      padding: 4px;
    }
    .info-label {
      font-weight: bold;
      width: 100px;
    }
    table.zimmet-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 10px;
    }
    .zimmet-table td {
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
      border-left: none;
      border-right: none;
      padding: 5px;
    }
    .zimmet-table th {
      border-top: 2px solid #000;
      border-bottom: 2px solid #000;
      border-left: none;
      border-right: none;
      background: #fff;
      padding: 8px 5px;
      text-align: center;
    }
    .declaration {
      font-size: 9px;
      margin-top: auto;
      text-align: justify;
      padding: 20px;
    }
    .signature-section {
      margin-top: 10px;
      padding: 0 20px;
    }
    .signature-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 9px;
    }
    .signature-table td {
      border: none;
      border-top: 1px solid #000;
      border-bottom: 1px solid #000;
      border-right: 1px solid #000;
      padding: 2px 4px;
      height: 24px;
      vertical-align: middle;
      text-align: center;
    }
    .signature-table td.left-edge {
      border-left: none;
    }
    .signature-table td.right-edge {
      border-right: none;
    }
    .footer-bar {
      font-size: 8px;
      display: flex;
      justify-content: space-between;
      border-top: 3px solid #000;
      padding: 8px 20px 6px;
      margin-top: 10px;
      background: #000;
      color: #fff;
    }
  </style>
</head>
<body>
<div class="wrapper">
  <div class="content">
    <div class="header">
      <div><h1>ZİMMET FORMU</h1></div>
      <div class="logo">
        <img src="https://portal.boltas.com/admin-assets/img/logo.jpg" alt="BOLTAS" height="35"><br>
        <span style="font-size:10px;">${formNo}</span>
      </div>
    </div>

    <table class="info-table">
      <tr><td class="info-label">Ad Soyad</td><td>: ${user.displayName || ''}</td></tr>
      <tr><td class="info-label">Bölüm</td><td>: ${user.Departman || ''}</td></tr>
      <tr><td class="info-label">Görev</td><td>: ${user.Unvan || ''}</td></tr>
    </table>

    <table class="zimmet-table">
      <thead>
        <tr>
          <th>Ürün</th>
          <th>Marka</th>
          <th>Model</th>
          <th>Seri No</th>
          <th>Zimmet Tarihi</th>
          <th>Zimmet Yapan</th>
          <th>İade Tarihi</th>
          <th>İade Alan</th>
        </tr>
      </thead>
      <tbody>
        ${zimmetler.map(z => `
        <tr>
          <td>${z.Ürün || ''}</td>
          <td>${z.Marka || ''}</td>
          <td>${z.Model || ''}</td>
          <td>${z.SeriNo || ''}</td>
          <td>${z.ZimmetTarih ? new Date(z.ZimmetTarih).toLocaleDateString('tr-TR') : ''}</td>
          <td>${z.ZimmetYapan || ''}</td>
          <td>${z.IadeTarih ? new Date(z.IadeTarih).toLocaleDateString('tr-TR') : ''}</td>
          <td>${z.IadeAlan || ''}</td>
        </tr>`).join('')}
      </tbody>
    </table>
  </div>

  <div class="declaration">
    Zimmetime aldığım / zimmetime verilen yukarıda detayı yazılı ekipmanın zimmetimde kaldığı sürece sorumluluğu tarafıma ait olup ekipmanda oluşabilecek herhangi bir hasar, kaybolma, çalınma, bozulma vb. durumlarda Bilgi Teknolojileri Birimini bilgilendireceğimi, ekipmanı üçüncü bir tarafa devretmeyeceğimi ve değişiklik yapmayacağımı, ekipmanın tahliye veya iliştirilmiş olabileceği başka bir araç ve ekipmanın sökümü ve geri teslimiyle ilgili Bilgi Teknolojileri Birimini bilgilendireceğimi ve geri teslimini sağlayacağımı beyan ve taahhüt ederim.
  </div>

  <div class="signature-section">
    <table class="signature-table">
      <tbody>
        <tr>
          <td class="left-edge" colspan="3"><strong>Teslim Alan</strong></td>
          <td colspan="3" class="right-edge"><strong>Teslim Eden</strong></td>
        </tr>
        <tr>
          <td class="left-edge"><strong>Tarih</strong></td>
          <td><strong>Ad Soyad</strong></td>
          <td><strong>İmza</strong></td>
          <td><strong>Tarih</strong></td>
          <td><strong>Ad Soyad</strong></td>
          <td class="right-edge"><strong>İmza</strong></td>
        </tr>
        <tr>
          <td class="left-edge"></td><td></td><td></td>
          <td></td><td></td><td class="right-edge"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="footer-bar">
    <div>BT.FR033</div>
    <div>MAVİ</div>
    <div>MAVİ</div>
    <div>R:00</div>
    <div>10 YIL</div>
    <div>T:${today}</div>
  </div>
</div>
</body>
</html>
  `;

  printWindow.document.write(html);
  printWindow.document.close();
  printWindow.onload = () => setTimeout(() => printWindow.print(), 500);
}


</script>

</body>
</html>
