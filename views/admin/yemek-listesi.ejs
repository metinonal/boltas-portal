<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Kontrol Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description">
    <meta content="Coderthemes" name="author">

    <%- include("partials/css") %>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>


</head>

<body class="loading" data-layout-color="light" data-leftbar-theme="dark" data-layout-mode="fluid"
    data-rightbar-onstart="true">
    <!-- Begin page -->
    <div class="wrapper">
        <!-- ========== Left Sidebar Start ========== -->
        <div class="leftside-menu">

            <!-- LOGO -->
            <%- include("partials/logo") %>

            <div class="h-100" id="leftside-menu-container" data-simplebar="">

                <!--- Sidemenu -->
                <%- include("partials/sidemenu") %>
                    <!-- End Sidebar -->

                    <div class="clearfix"></div>

            </div>
            <!-- Sidebar -left -->

        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="content">
                <!-- Topbar Start -->
                <%- include("partials/topbar") %>
                    <!-- end Topbar -->

                    <!-- Start Content-->
                    <div class="container-fluid">

                        <!-- start page title -->
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box">
                                    <h4 class="page-title">Yemek Listesi</h4>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-body">
                                        <form action="/ikyonetim/yemek-listesi" method="POST" enctype="multipart/form-data">
                                            <div class="row mb-3">
                                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                                    <label for="header" class="form-label">Yemek Listesi (Excel):</label>
                                                    <input id="yemekDosyasi" type="file" class="form-control"  name="yemekDosyasi" required>
                                                </div>
                                            </div>
                                            <button class="btn btn-primary" type="submit">Yükle</button>
                                        </form>
                                        <div id="output" style="margin-top: 20px;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- end page title -->

                        <!-- end row -->

                        <!-- end row -->
                    </div>
                     <!-- container -->

            </div> <!-- content -->

            <!-- Footer Start -->
            <%- include("partials/footer") %>
            <!-- end Footer -->

        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->


    </div>
    <!-- END wrapper -->

    <%- include("partials/scripts") %>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        document.getElementById('yemekDosyasi').addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (!file) {
            alert("Lütfen bir Excel dosyası seçin!");
            return;
          }
    
          const reader = new FileReader();
    
          // Dosya yüklendiğinde çalışacak
          reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, { type: 'array' });
    
            // İlk sayfayı al
            const sheetName = workbook.SheetNames[0];
            const sheet = workbook.Sheets[sheetName];
    
            // Sheet'i JSON formatına çevir, tarihleri ve belirli aralığı koruyarak
            const json = XLSX.utils.sheet_to_json(sheet, {
              header: 1,
              raw: false, // Tarih değerlerini düzgün şekilde al
              cellDates: true // Tarih hücrelerini tarih formatında al
            });
    
            // Sadece 9. ve 43. satırlar arasındaki verileri seç ve sütunları filtrele
            const selectedRows = json.slice(8, 43); // Satır aralığı (9. ve 43. dahil)
            const filteredData = selectedRows.map(row => row.slice(0, 5)); // A'dan F'ye kadar (0-5 sütunları)
    
            // Veriyi tabloda göster
            displayData(filteredData);
          };
    
          reader.readAsArrayBuffer(file);
        });
    
        // Verileri tablo olarak gösterme fonksiyonu
        function displayData(data) {
          const outputDiv = document.getElementById('output');
          outputDiv.innerHTML = ''; // Önceki içeriği temizle
    
          const table = document.createElement('table');
          table.style.borderCollapse = 'collapse';
          table.style.width = '100%';
    
          data.forEach(row => {
            const tr = document.createElement('tr');
    
            row.forEach(cell => {
              const td = document.createElement('td');
              td.textContent = cell || ''; // Hücre boşsa boş bırak
              td.style.border = '1px solid #ddd';
              td.style.padding = '8px';
              tr.appendChild(td);
            });
    
            table.appendChild(tr);
          });
    
          outputDiv.appendChild(table);
        }
      </script>

</body>

</html>